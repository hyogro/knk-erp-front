<!DOCTYPE HTML>
<html>

<head>
    <meta charset="UTF-8">
    <title><%= title %></title>

    <%- include ('../part/head.ejs') %>

    <style>
        .schedule-board {
            min-height: 35rem;
        }

        .schedule-board .title {
            font-size: 1.8rem;
            padding: 0;
            margin-bottom: 1.5rem;
            font-weight: bold;
        }

        .schedule-board .time {
            font-size: 1.4rem
        }
    </style>
</head>

<header>
    <%- include ('../part/header.ejs') %>
</header>

<body>
<%- include ('../part/menu.ejs') %>
<div id="main">
    <div class="row">
        <div class="col-9">
            <div id="calendar" style=""></div>
        </div>
        <div class="col-3 scroll">
            <div>
                <button type="button" class="btn btn-primary" onclick="location.href='/manage-schedule'">Í∑ºÎ¨¥ÏùºÏ†ïÍ¥ÄÎ¶¨</button>
                <button type="button" class="btn btn-success" onclick="location.href='/manage-vacation'">Ìú¥Í∞ÄÏùºÏ†ïÍ¥ÄÎ¶¨</button>
            </div>

            <div class="content-box" style="display: flex;margin-top: 1.1rem !important;">
                <div style="width: 50%">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="checkViewOptionAll" checked>
                        <label class="form-check-label" for="checkViewOptionAll">
                            ÌöåÏÇ¨ ÏùºÏ†ï
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="checkViewOptionDep" checked>
                        <label class="form-check-label" for="checkViewOptionDep">
                            ÌåÄ ÏùºÏ†ï
                        </label>
                    </div>
                </div>
                <div style="width: 50%">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="checkViewOptionOwn" checked>
                        <label class="form-check-label" for="checkViewOptionOwn">
                            ÎÇ¥ ÏùºÏ†ï
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="checkViewOptionVac" checked>
                        <label class="form-check-label" for="checkViewOptionVac">
                            Ìú¥Í∞Ä ÏùºÏ†ï
                        </label>
                    </div>
                </div>

            </div>
            <div class="content-box schedule-board">
                <span class="title" id="scheduleTitle">ÏùºÏ†ïÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</span>
                <span class="time" id="scheduleTime"></span>
                <hr>
                <div id="scheduleMemo">
                </div>
            </div>
        </div>
    </div>
</div>
</body>

</html>

<script>
    <%- include ('../common/check-data.js') %>

    let calendarEl = document.getElementById('calendar');
    let calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'ko',
        eventTimeFormat: {
            hour: '2-digit',
            minute: '2-digit',
            hour12: false
        },
        eventClick: function (info) {
            $("#scheduleTitle").text(info.event.title);
            let start = getTodayArr(info.event.start);
            let startTime = ("0" + start[3]).slice(-2) + ":" + ("0" + start[4]).slice(-2);
            let end = getTodayArr(info.event.end);
            let endTime = ("0" + end[3]).slice(-2) + ":" + ("0" + end[4]).slice(-2);
            $("#scheduleTime").text("üïí" + startTime + "~" + endTime);
            $("#scheduleMemo").text(info.event.extendedProps.memo);
        }
    });
    calendar.render();

    $("#checkViewOptionAll").change(checkViewOption);
    $("#checkViewOptionDep").change(checkViewOption);
    $("#checkViewOptionOwn").change(checkViewOption);
    $("#checkViewOptionVac").change(checkViewOption);

    drawCalendar('all dep own');

    function checkViewOption() {
        let viewOptionArr = [];
        if ($("#checkViewOptionAll").is(":checked")) viewOptionArr.push("all");
        if ($("#checkViewOptionDep").is(":checked")) viewOptionArr.push("dep");
        if ($("#checkViewOptionOwn").is(":checked")) viewOptionArr.push("own");
        let viewOption = viewOptionArr.join(" ");
        drawCalendar(viewOption);
    }

    function drawCalendar(viewOption) {
        calendar.removeAllEvents();

        let scheduleSendData = {};
        scheduleSendData.viewOption = viewOption;
        scheduleSendData.page = 0;
        scheduleSendData.size = 100;

        //Ï£ºÍ∞ÑÏùºÏ†ï Ï°∞Ìöå
        requestWithData('schedule/readScheduleList', scheduleSendData, setScheduleList);
        //Ìú¥Í∞ÄÏùºÏ†ï Ï°∞Ìöå
        if ($("#checkViewOptionVac").is(":checked")) {
            request('vacation/readVacationList', setVacationList);
        }

    }

    //Îã¨Î†• ÏùºÏ†ï ÏÖãÌåÖ
    function setScheduleList(res) {
        if (res.code === null) {
            return;
        }
        if (res.code === 'RSL001') {
            for (let i = 0; i < res.data.length; i++) {
                let schedule = {};

                schedule.title = res.data[i].title;
                schedule.memo = res.data[i].memo;
                schedule.start = res.data[i].startDate;
                schedule.end = res.data[i].endDate;

                calendar.addEvent(schedule);
            }
        } else if (res.code === 'RSL002') {
            alert("ÏùºÏ†ïÎ™©Î°ù Ï°∞Ìöå Ïã§Ìå®");
        }
    }

    //Îã¨Î†• ÏùºÏ†ï ÏÖãÌåÖ
    function setVacationList(res) {
        if (res.code === null) {
            return;
        }
        if (res.code === 'RVL001') {
            for (let i = 0; i < res.data.length; i++) {
                let schedule = {};

                schedule.title = res.data[i].title;
                schedule.memo = res.data[i].memo;
                schedule.start = res.data[i].startDate;
                schedule.end = res.data[i].endDate;

                calendar.addEvent(schedule);
            }
        } else if (res.code === 'RVL002') {
            alert("Ìú¥Í∞ÄÏ°∞Ìöå Ïã§Ìå®");
        }
    }

</script>