<!DOCTYPE HTML>
<html>

<head>
    <meta charset="UTF-8">
    <title><%= title %></title>

    <%- include ('./part/head.ejs') %>
    <link rel="stylesheet" type="text/css" href="/css/login.css">
</head>

<body>
<div class="login-card">
    <img class="logo" src="/images/logo2.png">

    <input type="text" id="id" placeholder="아이디" onkeyup="enterKey();">
    <input type="password" id="password" placeholder="비밀번호" onkeyup="enterKey();">
    <button type="submit" id="login" class="login login-submit">로그인</button>

    <div class="login-help">
        <a href="#">아이디찾기</a> | <a href="#">비밀번호찾기</a>
    </div>
</div>
</body>

</html>

<script>

    const token = $.cookie("token");

    // 이미 로그인된 상태
    if (token !== undefined && token != "null") {
        location.href = "/";
    }

    function enterKey() {
        if (window.event.keyCode == 13) {
            login($("#id").val(), $("#password").val());
        }
    }

    //로그인버튼
    $("#login").click(function () {
        login($("#id").val(), $("#password").val());
    });

    function login(id, password) {
        if (emptyValue(id) == false) {
            alert('아이디를 입력해주세요.');
            return false;
        } else if (emptyValue(password) == false) {
            alert('비밀번호를 입력해주세요.');
            return false;
        }

        let loginData = new Object();
        loginData.memberId = id;
        loginData.password = password;

        // ajax 통신
        $.ajax({
            type: "POST",
            url: '<%= api %>' + 'account/login',
            contentType: 'application/json',
            dataType: 'json',
            data: JSON.stringify(loginData),
            success: function (res) {
                $.cookie('token', res.tokenDto.accessToken, {expires: 1, path: '/'});
                $.cookie('id', loginData.memberId);

                location.href = '/';
                //토큰 규격: 헤더
                console.log("Bearar " + res.tokenDto.accessToken);
            },
            error: function (err) {
                console.log(err.status);
                alert('등록되지 않은 아이디이거나, 잘못된 비밀번호입니다.');
            }
        });
    }

    function emptyValue(val) {
        if (val == null || val == '') {
            return false;
        }
    }
</script>