<!DOCTYPE HTML>
<html>

<head>
    <meta charset="UTF-8">
    <title><%= title %></title>

    <%- include ('./part/head.ejs') %>

    <style>
        .company-info {
            font-size: 2rem;
        }

        .schedule-board {
            text-align: left;
        }

        .schedule-board th {
            width: 30%;
        }

        .schedule-board td {
            width: 70%;
            cursor: pointer;
        }

        .commute-board {
            display: none;
            text-align: center;
            font-size: 2rem;
        }

        .commute-board .count {
            font-size: 4rem;
            font-weight: bold;
        }

        .notice-board .notice-title {
            cursor: pointer;
            text-align: left;
        }

        .notice-board .notice-title span {
            color: #2940d3;
            font-size: 1.4rem;
        }

        .schedule-board td:hover,
        .schedule-board td:focus,
        .schedule-board td:active,
        .notice-board .notice-title:hover {
            text-decoration: underline;
        }
    </style>
</head>

<header>
    <%- include ('part/header.ejs') %>
</header>

<body>
<%- include ('part/menu.ejs') %>
<div id="main">
    <div class="row main-title">
        2021 6ì›” 7ì¼ (ì›”)
    </div>
    <div class="row company-info">
        <div class="col-lg" style="text-align: left">
            êµ¬ì´ì•¤ê¸ˆìš°í†µì‹  - <span id="departmentName"></span>
        </div>
        <div class="col-lg" style="text-align: right">
            ì´ ì§ì› ìˆ˜: <span id="memberCount"></span>ëª…
        </div>
    </div>

    <div class="row content-box">
        <div class="content-box-title">ğŸ”¹ ì£¼ê°„ì¼ì •</div>

        <div id="calendar" style="max-height: 40rem"></div>

        <div class="scroll" style="max-height: 30rem;overflow-y: auto">
            <table class="schedule-board">
                <tbody id="scheduleBoard">
                </tbody>
            </table>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="scheduleModal" tabindex="-1" aria-labelledby="scheduleModalLabel"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <div id="scheduleTitle"></div>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div id="scheduleMeme" style="padding: 1rem 0"></div>
                        <hr>
                        <div style="font-size: 1.4rem">
                            <div>ì‹œì‘ì¼ : <span id="scheduleStartDate"></span></div>
                            <div>ì™„ë£Œì¼ : <span id="scheduleEndDate"></span></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">í™•ì¸</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xl content-box">
            <div class="content-box-title">ğŸ”¹ ì¶œí‡´ê·¼ê¸°ë¡</div>
        </div>
        <div class="col-xl content-box">
            <div class="content-box-title">ğŸ”¹ ê³µì§€ì‚¬í•­</div>
            <table class="notice-board">
                <thead>
                <tr>
                    <th width="10%">No</th>
                    <th width="50%">ì œëª©</th>
                    <th width="20%">ì‘ì„±ì</th>
                    <th width="20%">ë“±ë¡ì¼</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>1</td>
                    <td class="notice-title">ì²«ê³µì§€ì…ë‹ˆë‹¹ <span>(10)</span></td>
                    <td>ì„í˜„ì£¼</td>
                    <td>2021.06.07</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="row commute-board">
        <div class="col-md content-box"
             style="border-top: 5px solid blue;color: #1354d9">
            ì¶œê·¼
            <div class="count" id="onWork"></div>
        </div>
        <div class="col-md content-box"
             style="border-top: 5px solid orange; color: #e07c00">
            ë¯¸ì¶œê·¼
            <div class="count" id="yetWork"></div>
        </div>
        <div class="col-md content-box"
             style="border-top: 5px solid red;color: #bf0920">
            ì§€ê°
            <div class="count" id="lateWork"></div>
        </div>
        <div class="col-md content-box"
             style="border-top: 5px solid green;color: #01853d">
            íœ´ê°€
            <div class="count"></div>
        </div>
    </div>

    <div class="row">
        <div class="col content-box">
            <div class="content-box-title">ğŸ”¹ ì£¼ê°„í†µê³„</div>
            <!--            íŒ€ì¥, ë¶€ì¥ = ì£¼ê°„ ì¶œê·¼, ë¯¸ì¶œê·¼, ì§€ê°, íœ´ê°€ í†µê³„-->
            <!--            ì˜¤ëŠ˜ê¸°ì¤€ 7ì¼ì „-->
            <canvas id="commuteChart" height="50"></canvas>
        </div>
    </div>

    <div class="row">
        <div class="col content-box">
            <div class="content-box-title">ğŸ”¹ ì£¼ê°„ê·¼ë¬´ì‹œê°„</div>
            <!--            íŒ€ì› = ì£¼ê°„ ê·¼ë¬´ì‹œê°„ í†µê³„-->
        </div>
    </div>
</div>
</body>

</html>

<script>
    <%- include ('common/check-data.js') %>

    var ctx = document.getElementById('commuteChart').getContext('2d');
    var commuteChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['21.06.08', '21.06.09', '21.06.10', '21.06.11', '21.06.12', '21.06.13'],
            datasets: [{
                label: 'ì¶œê·¼',
                data: [50, 45, 49, 50, 45, 47],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)'
                ],
                borderColor: [
                    'rgba(255,99,132,1)'
                ],
                borderWidth: 1
            },
                {
                    label: 'í‡´ê·¼',
                    data: [45, 50, 44, 49, 45, 50],
                    backgroundColor: [
                        'rgba(54, 162, 235, 0.2)'
                    ],
                    borderColor: [
                        'rgba(54, 162, 235, 1)'
                    ],
                    borderWidth: 1
                }
            ]
        },
        options: {}
    });

    setBoardData();

    //ì „ì²´ ì •ë³´ ì¡°íšŒ
    function setBoardData() {
        //ë¶€ì„œì •ë³´ ì¡°íšŒ
        request('department/readDepartmentNameAndMemberCount', setDepartmentInfo);
        //ì¼ì •ìš”ì•½(ì¶œí‡´ê·¼) ì¡°íšŒ
        request('attendance/readAttendanceSummary', setAttendanceSummary);

        let scheduleSendData = {};
        scheduleSendData.viewOption = 'all dep own';
        scheduleSendData.page = 0;
        scheduleSendData.size = 100;
        let today = new Date();
        scheduleSendData.startDate = getToday(today);
        scheduleSendData.endDate = getToday(new Date(today.setDate(today.getDate() + 7)));

        //ì£¼ê°„ì¼ì • ì¡°íšŒ
        requestWithData('schedule/readScheduleList', scheduleSendData, setScheduleList);
    }

    //ë¶€ì„œì •ë³´ ì¡°íšŒ
    function setDepartmentInfo(res) {
        if (res.code === null) {
            return;
        }
        if (res.code === 'RDAM001') {
            $("#departmentName").text(res.data.departmentName);
            $("#memberCount").text(res.data.memberCount);
        } else if (res.code === 'RDAM002') {
            alert("ë¶€ì„œì •ë³´ ì¡°íšŒ ì‹¤íŒ¨");
        } else if (res.code === 'RDAM003') {
            alert("ë¶€ì„œì •ë³´ ì¡°íšŒ ì‹¤íŒ¨\nì†Œì†ëœ ë¶€ì„œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        }
    }

    //ì¼ì •ìš”ì•½(ì¶œí‡´ê·¼) ì¡°íšŒ
    function setAttendanceSummary(res) {
        if (res.code === null) {
            return;
        }
        if (res.code === 'RSS001') {
            $(".commute-board").css('display', 'flex');
            $("#onWork").text(res.data.onWork);
            $("#yetWork").text(res.data.yetWork);
            $("#lateWork").text(res.data.lateWork);
        } else if (res.code === 'RSS002') {
            alert("ì¼ì •ìš”ì•½ ì¡°íšŒ ì‹¤íŒ¨");
        } else if (res.code === 'RSS003') {
            $(".commute-board").hide();
            console.log("ì¼ì •ìš”ì•½ ì¡°íšŒ ì‹¤íŒ¨\nê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
        }
    }

    function setScheduleList(res) {
        console.log(res);
        if (res.code === null) {
            return;
        }
        if (res.code === 'RSL001') {
            $("#scheduleBoard").empty();
            for (let i = 0; i < res.data.length; i++) {
                let date = '';
                let dateArr1 = getTodayArr(res.data[i].startDate);
                let dateArr2 = getTodayArr(res.data[i].endDate);
                if (dateArr1.toString() === dateArr2.toString()) {
                    date = dateArr1[1] + 'ì›”' + dateArr1[2] + 'ì¼';
                } else {
                    date = dateArr1[1] + 'ì›”' + dateArr1[2] + 'ì¼ ~ ' + dateArr2[1] + 'ì›”' + dateArr2[2] + 'ì¼';
                }

                let html = '<tr>' +
                    '<th>' + date + '</th>' +
                    '<td data-bs-toggle="modal" data-bs-target="#scheduleModal"' +
                    ' onclick="detailSchedule(\'' + res.data[i].title + '\', \'' + res.data[i].memo + '\', ' +
                    '\'' + res.data[i].startDate + '\', \'' + res.data[i].endDate + '\')">'
                    + res.data[i].title + '</td>' +
                    '</tr>';

                $("#scheduleBoard").append(html);
            }
        } else if (res.code === 'RSL002') {
            alert("ì¼ì •ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨");
        }
    }

    //ì¼ì • ìì„¸íˆë³´ê¸°
    function detailSchedule(title, memo, startDate, endDate) {
        $("#scheduleTitle").text(title);
        $("#scheduleMeme").text(memo);

        let start = startDate.split("T");
        $("#scheduleStartDate").text(" ğŸ“… " + start[0].replaceAll("-", ".") + " ğŸ•’ " + start[1]);
        let end = endDate.split("T");
        $("#scheduleEndDate").text(" ğŸ“… " + end[0].replaceAll("-", ".") + " ğŸ•’ " + end[1]);
    }

    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'listWeek',
            locale:'ko',
            events: [
                {
                    title: 'Meeting',
                    start: '2021-06-09T14:30:00'
                },
                {
                    title: 'Birthday Party',
                    start: '2021-06-11T14:30:00'
                }
            ],
            eventDidMount: function(info) {
                if (info.event.extendedProps.status === 'done') {

                    // Change background color of row
                    info.el.style.backgroundColor = 'red';

                    // Change color of dot marker
                    var dotEl = info.el.getElementsByClassName('fc-event-dot')[0];
                    if (dotEl) {
                        dotEl.style.backgroundColor = 'white';
                    }
                }
            }

        });
        calendar.render();
    });

</script>